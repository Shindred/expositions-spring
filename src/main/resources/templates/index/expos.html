<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <meta charset="UTF-8">
    <title>Expositions</title>
    <!--    <link href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css rel="stylesheet"-->
    <!--          integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body th:fragment="allExpos">
<!--<c:set var="role" value="${sessionScope.userData.userRole.role}"/>-->
<div th:if="${session.infMsg != null}">
    <!--    <span th:text="#{${session.infMsg}}"></span>-->
    <span th:text="${session.infMsg}"></span>

</div>
<div class="row justify-content-center" th:fragment="exps">
    <a th:href="@{/index}">Home</a>
<!--    <div class="dropdown col-4">-->
<!--        <button class="btn btn-primary btn-sm dropdown-toggle" type="button" id="dropdownMenuButton1"-->
<!--                data-bs-toggle="dropdown" aria-expanded="false">-->
<!--            sort-->
<!--        </button>-->
<!--        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">-->
<!--            <li><a class="dropdown-item" th:href="@{${'/index/expos'}(page=${currPage - 1},size=${size},sortBy='price')}">by price</a>-->
<!--            </li>-->
<!--            <li><a class="dropdown-item" th:href="@{${'/index/expos'}(page=${currPage - 1},size=${size},sortBy='expoDate')}">by date</a>-->
<!--            </li>-->
<!--            <li><a class="dropdown-item" th:href="@{${'/index/expos'}(page=${currPage - 1},size=${size},sortBy='theme_name')}">by theme</a>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </div>-->
    <div sec:authorize="hasAuthority('ADMIN')">
        <div th:insert="common/fragments :: sortAdmin"></div>
        <div th:insert="common/fragments.html :: amountAdmin"></div>
    </div>
    <div sec:authorize="hasAuthority('USER')">
        <div th:insert="common/fragments :: sortUser"></div>
        <div th:insert="common/fragments.html :: amountUser"></div>

    </div>

    <div sec:authorize="hasAuthority('ROLE_ANONYMOUS')" class="row">
            <div th:insert="common/fragments :: sortGuest" class="col-md-4"></div>
            <div th:insert="common/fragments.html :: amountGuest" class="col-md-8"></div>
    </div>
<!--    <div class="dropdown">-->
<!--        <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">-->
<!--            amount-->
<!--        </button>-->
<!--        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">-->
<!--            <li><a class="dropdown-item" th:href="@{${'/index/expos'}(size=${2},sortBy=${sortBy})}">2</a></li>-->
<!--            <li><a class="dropdown-item" th:href="@{${'/index/expos'}(size=${10},sortBy=${sortBy})}">10</a></li>-->
<!--            <li><a class="dropdown-item" th:href="@{${'/index/expos'}(size=${25},sortBy=${sortBy})}">25</a></li>-->
<!--        </ul>-->
<!--    </div>-->
</div>
<table class="table table-light table-hover">
    <h4 class="text-center">Expositions</h4>
    <thead>
    <tr>
        <th scope="col">Expos</th>
        <th scope="col">Expo_date</th>
        <th scope="col">Expo_time</th>
        <th scope="col">Price</th>
        <th scope="col">Sold</th>
        <th scope="col">Halls</th>
        <th scope="col">Theme</th>
        <th scope="col">Tickets</th>
        <th scope="col">Status</th>
    </tr>
    </thead>
    <tbody th:each="expo : ${expos}">
    <tr>
         <div sec:authorize="hasAuthority('ADMIN')">
            <td>
                <a th:href="@{/admin/expos/{id}(id=${expo.id})}" th:text="${expo.name}"></a>
            </td>
        </div>
        <div sec:authorize="hasAuthority('USER')">
            <td>
                <a th:href="@{/user/expos/{id}(id=${expo.id})}" th:text="${expo.name}"></a>
            </td>
        </div>
        <div sec:authorize="hasAuthority('ROLE_ANONYMOUS')">
            <td th:text="${expo.name}"></td>
        </div>
        <td th:text="${expo.expoDate.format(dateFormat)}"></td>
        <td th:text="${expo.expoTime.format(timeFormat)}"></td>
        <td th:text="${expo.price}"></td>
        <td th:text="${expo.statistic.sold}"></td>
        <td>
                <span th:each="hall : ${expo.halls}">
                    <p th:text="${hall.name}"></p>
                </span>
        </td>
        <td th:text="${expo.theme.name}"></td>
        <td th:switch="${expo.statistic.tickets}">
            <p th:case="0">sold out</p>
            <p th:default>have</p>
        </td>
        <td th:if="${expo.statusId eq 1}">
            active
        </td>
        <td th:if="${expo.statusId eq 2}">
            canceled
        </td>

        <!--            <c:if test="${role.equals('user')}">-->
        <td sec:authorize="hasAuthority('USER')">
            <form method="post" th:action="@{/user/expos/buy/{id}(id=${expo.id})}">
                <input type="hidden" th:name="expo" th:value="${expo}">
                <button type="submit" class="btn btn-success btn-sm">buy</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>


<div sec:authorize="hasAuthority('ADMIN')" class="row">
    <div th:insert="common/fragments :: paginateAdmin" class="text-center"></div>
</div>

<div sec:authorize="hasAuthority('USER')" class="row">
    <div th:insert="common/fragments :: paginateUser" class="text-center"></div>
</div>

<div sec:authorize="hasAuthority('ROLE_ANONYMOUS')" class="row">
    <div th:insert="common/fragments :: paginateGuest" style="margin-left: 40%;"></div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<!--<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js referrerpolicy="no-referrer"></script>-->
<!--<script src=https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN" crossorigin="anonymous"></script>-->
<!--<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/" crossorigin="anonymous"></script>-->
</body>
</html>